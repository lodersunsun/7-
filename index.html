
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>蛋鸡生产日报工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        table th, table td {
            border: 1px solid #ccc;
            padding: 6px 10px;
            text-align: center;
        }
        input, textarea {
            width: 90%;
        }
        textarea {
            height: 200px;
            white-space: pre;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>蛋鸡生产日报自动生成工具</h1>
    <h2>基础信息</h2>
    <table>
        <tr><td>日期</td><td><input type="date" id="date"></td>
            <td>鸡舍</td><td><input type="text" id="flock" placeholder="如 临猗7栋"></td></tr>
        <tr><td>品种</td><td><input type="text" id="breed" placeholder="如 粉六"></td>
            <td>日龄</td><td><input type="number" id="age"></td></tr>
        <tr><td>存栏</td><td><input type="number" id="stock"></td>
            <td>光照</td><td><input type="number" id="light"></td></tr>
        <tr><td>天气</td><td><input type="text" id="weather"></td>
            <td>用药</td><td><textarea id="medication"></textarea></td></tr>
    </table>

    <h2>生产数据</h2>
    <table>
        <tr><td>产蛋个数</td><td><input type="number" id="eggCount"></td>
            <td>产蛋总重量(kg)</td><td><input type="number" id="eggWeight"></td></tr>
        <tr><td>破蛋个数</td><td><input type="number" id="brokenEggs"></td>
            <td>死淘数</td><td><input type="number" id="deadCount"></td></tr>
        <tr><td>收蛋时间</td><td><input type="text" id="collectTime"></td>
            <td>总饮水(m³)</td><td><input type="number" id="waterTotal"></td></tr>
        <tr><td>昨日料表</td><td><input type="number" id="feedMeterPrev"></td>
            <td>今日料表</td><td><input type="number" id="feedMeterToday"></td></tr>
        <tr><td>进料数</td><td><input type="number" id="feedAdded"></td>
            <td>对比用料</td><td><input type="number" id="feedCompare"></td></tr>
        <tr><td>添加剂</td><td colspan="3"><input type="text" id="additive"></td></tr>
    </table>

    <h2>饲料批次记录</h2>
    <table id="feedTable">
        <tr><th>料号</th><th>配方编号</th><th>生产日期</th><th>数量(kg)</th><th>操作</th></tr>
        <tr>
            <td><input type="text" name="feedNo"></td>
            <td><input type="text" name="formulaNo"></td>
            <td><input type="text" name="prodDate"></td>
            <td><input type="number" name="feedQty"></td>
            <td><button type="button" class="delRow">删除</button></td>
        </tr>
    </table>
    <button id="addRow">添加一行</button>

    <h2>计算结果</h2>
    <table>
        <tr><td>日总采食</td><td><span id="feedTotalDisplay"></span></td>
            <td>日均采食</td><td><span id="feedPerHenDisplay"></span> <span id="feedDiffDisplay"></span></td></tr>
        <tr><td>产蛋率</td><td><span id="layRateDisplay"></span></td>
            <td>只均产蛋量</td><td><span id="eggMassPerHenDisplay"></span></td></tr>
        <tr><td>破蛋率</td><td><span id="breakRateDisplay"></span></td>
            <td>箱重(斤)</td><td><span id="boxWeightDisplay"></span></td></tr>
        <tr><td>日均饮水(ml/只)</td><td><span id="waterPerHenDisplay"></span></td>
            <td>料蛋比</td><td><span id="feedEggRatioDisplay"></span></td></tr>
        <tr><td>水料比</td><td colspan="3"><span id="waterFeedRatioDisplay"></span></td></tr>
    </table>

    <h2>日报文本</h2>
    <textarea id="reportText" readonly></textarea>
    <br>
    <button onclick="generateReportText()">生成日报</button>

    <script>
        document.getElementById('addRow').addEventListener('click', function() {
            const table = document.getElementById('feedTable');
            const newRow = table.insertRow();
            ['feedNo','formulaNo','prodDate','feedQty'].forEach(name => {
                const cell = newRow.insertCell();
                const input = document.createElement('input');
                input.name = name;
                cell.appendChild(input);
            });
            const opCell = newRow.insertCell();
            const delBtn = document.createElement('button');
            delBtn.type = 'button';
            delBtn.textContent = '删除';
            delBtn.onclick = () => table.deleteRow(newRow.rowIndex);
            opCell.appendChild(delBtn);
        });

        function generateFeedLabelText() {
            const table = document.getElementById('feedTable');
            let text = '';
            for (let i = 1; i < table.rows.length; i++) {
                const cells = table.rows[i].cells;
                const feedNo = cells[0].querySelector('input').value;
                const formula = cells[1].querySelector('input').value;
                const prodDate = cells[2].querySelector('input').value;
                const qty = cells[3].querySelector('input').value;
                if (feedNo || formula || prodDate || qty) {
                    text += `${feedNo}/${formula}/${prodDate}（${qty}）\n`;
                }
            }
            return text;
        }

        function generateReportText() {
            const $ = id => document.getElementById(id);
            const get = id => parseFloat($(id).value) || 0;
            const stock = get('stock'), eggCount = get('eggCount'), eggWeight = get('eggWeight');
            const brokenEggs = get('brokenEggs'), waterTotal = get('waterTotal');
            const prev = get('feedMeterPrev'), today = get('feedMeterToday'), added = get('feedAdded'), compare = get('feedCompare');
            const totalFeed = prev + added - today;
            const dailyFeed = stock ? totalFeed / stock * 1000 : 0;
            const layRate = stock ? eggCount / stock * 100 : 0;
            const eggMass = stock ? eggWeight / stock * 1000 : 0;
            const breakRate = eggCount ? brokenEggs / eggCount * 100 : 0;
            const boxWeight = eggCount ? eggWeight / eggCount * 360 * 2 : 0;
            const waterPerHen = stock ? waterTotal / stock * 1000000 : 0;
            const feedEggRatio = eggMass ? dailyFeed / eggMass : 0;
            const waterFeedRatio = dailyFeed ? waterPerHen / dailyFeed : 0;
            const feedDiff = dailyFeed - compare;
            // update display
            $('feedTotalDisplay').innerText = totalFeed.toFixed(2);
            $('feedPerHenDisplay').innerText = dailyFeed.toFixed(1);
            $('feedDiffDisplay').innerText = `(${feedDiff.toFixed(1)})`;
            $('layRateDisplay').innerText = layRate.toFixed(1);
            $('eggMassPerHenDisplay').innerText = eggMass.toFixed(1);
            $('breakRateDisplay').innerText = breakRate.toFixed(2);
            $('boxWeightDisplay').innerText = boxWeight.toFixed(2);
            $('waterPerHenDisplay').innerText = waterPerHen.toFixed(1);
            $('feedEggRatioDisplay').innerText = feedEggRatio.toFixed(2);
            $('waterFeedRatioDisplay').innerText = waterFeedRatio.toFixed(2);

            const dateObj = new Date($('date').value);
            const dateStr = (dateObj.getMonth() + 1) + '月' + dateObj.getDate() + '日';
            const report = \`\${$('flock').value}
日期：\${dateStr}
饲料标签：
\${generateFeedLabelText()}品种：\${$('breed').value}
日龄：\${$('age').value}
存栏：\${stock}
死淘：\${$('deadCount').value}
日总采食：\${totalFeed.toFixed(2)}
日均采食：\${dailyFeed.toFixed(1)} (\${feedDiff.toFixed(1)})
产蛋个数：\${eggCount}
产蛋率：\${layRate.toFixed(1)}
收蛋时间：\${$('collectTime').value}
料蛋比：\${feedEggRatio.toFixed(2)}
产蛋斤数：\${eggWeight.toFixed(2)}
只均产蛋量：\${eggMass.toFixed(1)}
破蛋个数：\${brokenEggs}
破蛋率：\${breakRate.toFixed(2)}
箱重：\${boxWeight.toFixed(2)}（斤）
总饮水：\${waterTotal.toFixed(2)}
日均饮水：\${waterPerHen.toFixed(1)}
光照：\${$('light').value}
天气：\${$('weather').value}
用药：
\${$('medication').value}
\`;

            $('reportText').value = report;
        }
    </script>
</body>
</html>
